---
- hosts: all
  vars:
    package_manager_utils: >-
        {% if ansible_distribution_major_version|int >= 8 -%}
        dnf-utils
        {%- else -%}
        yum-utils
        {%- endif -%}
  tasks:
    - name: install yum/dnf-utils
      become: true
      package:
        name: "{{ package_manager_utils }}"
        state: present

    - name: get repoquery list
      become: true
      shell: >
        set -o pipefail &&
        repoquery  --repofrompath={{ item.dependency_name }},{{ item.dependency_base_url }} \
        --repoid={{ item.dependency_name }} -q -a | tee -a  {{ ansible_user_dir }}/dependency_repoquery_list_{{ item.dependency_name }}.log
      changed_when: false
      with_items: "{{ dependency }}"
