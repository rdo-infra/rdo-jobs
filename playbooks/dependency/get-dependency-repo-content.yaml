---
- hosts: all
  vars:
    package_manager_utils: >-
        {% if ansible_distribution_major_version|int >= 8 -%}
        dnf-utils
        {%- else -%}
        yum-utils
        {%- endif -%}
  tasks:
    - name: install yum/dnf-utils
      become: true
      package:
        name: "{{ package_manager_utils }}"
        state: present

    - name: include dependency-related vars
      include_vars:
        config/release/dependency_ci/{{ job.dependency_name|default(dependency_name) }}/repo_config.yaml

    - name: get repoquery list
      become: true
      shell: >
        set -o pipefail &&
        repoquery  --repofrompath={{ item.reponame }},{{ item.baseurl }} \
        --repoid={{ item.reponame }} -q -a | tee -a  {{ ansible_user_dir }}/dependency_repoquery_list.log
      with_items: "{{ add_repos }}"
