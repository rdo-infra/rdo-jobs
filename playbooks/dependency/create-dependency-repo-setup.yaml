---
- hosts: all
  tasks:
    - name: Create dependency repos
      set_fact:
        dependency_repos_item:
          type: generic
          reponame: "{{ item.dependency_name }}"
          filename: "{{ item.dependency_name }}-dependency.repo"
          priority: 1
          baseurl: "{{ item.dependency_base_url }}"
          update_container: false
      with_items: "{{ dependency }}"
      register: dependency_repos_result

    - name: Make a list of dependency repos
      set_fact:
        dependency_repos:
          "{{ dependency_repos_result.results | map(attribute='ansible_facts.dependency_repos_item') | list }}"

    - name: Add dependency repos to add_repos
      set_fact:
        featureset_override:
          add_repos:
            "{{ add_repos|default([]) + dependency_repos }}"
        cacheable: true
