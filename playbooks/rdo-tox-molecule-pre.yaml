- hosts: all
  tasks:

    # to test rhel8 rhui based containers we need to be sure that we can
    # resolve rhui-cds
    - name: adds rhui-cds to /etc/hosts
      become: yes
      lineinfile:
        dest: /etc/hosts
        regexp: '.*rhui-cds$'
        line: "38.145.32.241 rhui-cds"
        state: present

    - name: add insecure registries configuration to docker deamon
      become: true
      copy:
        content: |-
          {"insecure-registries": ["{{ ansible_default_ipv4.address }}"]}
        dest: /etc/docker/daemon.json

    - name: Restart docker
      become: true
      service:
        name: docker
        state: restarted
