- hosts: all
  tasks:
    - shell:
        cmd: |
          set +e
          sudo yum -y install createrepo mock redhat-rpm-config rpmdevtools
          sudo usermod -a -G mock zuul

    - shell:
        cmd: |
          if [[ "$ZUUL_PIPELINE" =~ "openstack-" ]]; then
              timeout --signal=SIGKILL 3600 ./scripts/run_project_tests.sh http://review.rdoproject.org/r/p/rdoinfo.git
              ret=$?
          else
              timeout --signal=SIGKILL 3600 ./scripts/run_tests.sh http://review.rdoproject.org/r/p/rdoinfo.git "centos" "https://trunk.rdoproject.org/centos7/" ""
              ret=$?
          fi
          # Retrieve logs/repositories/packages
          mkdir ~/buildset
          cp -a DLRN/logs/* ~/buildset/
          exit $ret
        chdir: "{{ zuul.projects['managesf.softwarefactory-project.io/DLRN'].src_dir }}"
