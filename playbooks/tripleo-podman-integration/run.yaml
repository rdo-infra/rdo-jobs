---
- hosts: all
  tasks:
    - block:
        - name: Run make rpm
          shell:
            cmd: |
                bash build_rpm.sh
            chdir: "{{ ansible_user_dir }}/{{ zuul.projects['github.com/containers/libpod'].src_dir }}/contrib"
          changed_when: true

        - name: Setup log path fact
          include_role:
          name: set-zuul-log-path-fact

        - name: Define buildset artifacts location
          zuul_return:
          data:
            buildset_artifacts_url: "https://logs.rdoproject.org/{{ zuul_log_path }}/buildset"

      rescue:
        - name: Don't block
          debug:
            msg: podman rpm build failed
