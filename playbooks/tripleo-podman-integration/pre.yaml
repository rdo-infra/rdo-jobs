---
- hosts: all
  tasks:

    # mock comes from epel on centos-8
    # golang comes from epel on cenots-7
    - name: Install EPEL
      become: true
      package:
        name: epel-release

    # Mandatory as on nodepool images we may have it pre-installed but disabled
    - name: enable EPEL
      become: true
      command: yum-config-manager --enable epel
      # sadly output does help with idempotency determination
      changed_when: true

    - name: Install pre-requisites
      package:
        name:
          - createrepo
          - golang
          - mock
          - redhat-rpm-config
          - rpmdevtools
        state: present
      become: true

    - name: Add zuul user to mock group
      become: true
      shell:
        cmd: |
          usermod -a -G mock zuul
      changed_when: true
