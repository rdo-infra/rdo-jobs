---
- hosts: all
  tasks:
    - name: enable rhui repository
      become: true
      when:
        - ansible_distribution_major_version >= "8"
        - ansible_distribution == "RedHat"
      shell: |
        set -euox pipefail
        dnf config-manager --enable rhui-*
        dnf makecache
        dnf repolist
      changed_when: true

    - name: Install pre-requisites
      vars:
        # centos-8: go-lang
        # rhel-8: go-lang
        # fedora-[28|29|30]: golang
        golang_pkg_name: "{% if ansible_distribution == 'Fedora' %}golang{% else %}go-lang{% endif %}"
      become: true
      package:
        name:
          - "{{ golang_pkg_name }}"
          - createrepo
          - mock
          - redhat-rpm-config
          - rpmdevtools
        state: present

    - name: Add zuul user to mock group
      become: true
      shell:
        cmd: |
          usermod -a -G mock zuul
      changed_when: true
