---
# Assures we have a version of tox that is future proof.
#
# Tox introduced ability to boostrap a newer version of itself when minversion
# requires it in 3.8.0 but sadly our distributions are using a much older
# version.
#
# This should avoid case where use of newer syntax in tox.ini causes errors.
- hosts: all
  environment:
    PIP_DISABLE_PIP_VERSION_CHECK: "1"
    # Avoid 2020-01-01 warnings: https://github.com/pypa/pip/issues/6207
    PYTHONWARNINGS: ignore:DEPRECATION::pip._internal.cli.base_command
  tasks:

    - name: Upgrade tox if under 3.8.0
      shell: |
        set -euox
        {{ ansible_python.executable }} -m pip install --user tox>=3.8.0
        {{ ansible_python.executable }} -m tox --version
