---
- hosts: all
  tasks:
    - name: Install container runtime
      include_role:
        name: ensure-podman

    - name: Setup build-container-image role
      include_role:
        name: build-container-image
      vars:
        zuul_work_dir: "{{ zuul.projects['review.rdoproject.org/rdo-infra/releng'].src_dir }}"
        container_command: podman
        container_registry_credentials:
          quay.io:
            username: user
            password: pwd
        container_images:
          - context: container
            container_filename: Containerfile
            registry: quay.io
            repository: rdo-infra/rdo-toolbox
            tags: latest

    - name: Setup upload-container-image role
      include_role:
        name: upload-container-image
      when:
        - push_to_registry|default(false)
      vars:
        zuul_work_dir: "{{ zuul.projects['review.rdoproject.org/rdo-infra/releng'].src_dir }}"
        container_command: podman
        container_registry_credentials:
          quay.io:
            username: user
            password: pwd
        container_images:
          - context: container
            container_filename: Containerfile
            registry: quay.io
            repository: rdo-infra/rdo-toolbox
            tags: latest
