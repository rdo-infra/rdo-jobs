- name: Prepare for tripleo deployment
  vars: &ooo_vars
    dpa_dir: "{{ dpa_dir_override | default('/home/zuul/src/github.com/openstack-k8s-operators/data-plane-adoption') }}"
    rdo_dir: "/home/zuul/src/review.rdoproject.org/rdo-jobs/playbooks/data_plane_adoption"
    framework_dir: "/home/zuul/src/github.com/openstack-k8s-operators/ci-framework"
    cifmw_datadir: "/home/zuul/ci-framework-data"
    tripleo_passwords_file: "{{ tripleo_passwords | default('/home/zuul/overcloud-passwords.yaml') }}"
    multi_cell: true
  ansible.builtin.import_playbook: deploy_tripleo_prepare.yaml

- name: Remove ssh login var controllers in secrets.yaml
  when: adoption_extra_vars is defined
  ansible.builtin.lineinfile:
    path: "{{ rdo_dir }}/secrets.yaml"
    regexp: 'controller\d_ssh:'
    value: "#controllerX_ssh:"

- name: Remove ipa_ssh var in secrets.yaml
  when: adoption_extra_vars is defined
  ansible.builtin.lineinfile:
    path: "{{ rdo_dir }}/secrets.yaml"
    regexp: 'ipa_ssh:'
    value: "#ipa_ssh:"

- name: Run tripleo adoption
  vars: *ooo_vars
  ansible.builtin.import_playbook: deploy_tripleo_run.yaml
