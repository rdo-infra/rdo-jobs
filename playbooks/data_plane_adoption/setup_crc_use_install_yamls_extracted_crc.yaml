---
# NOTE: It is more a workaround until the playbook would not be migrated
# to ci-framework project dir.
# NOTE: It is very similar to playbook:
# https://github.com/openstack-k8s-operators/ci-framework/blob/main/deploy-edpm.yml
- name: Run nested Ansible
  hosts: controller
  tasks:
    - name: Install community.general collection
      ansible.builtin.command: ansible-galaxy collection install community.general

    - name: Run setup_crc_use_install_yamls_extracted_crc playbook
      vars:
        rdo_jobs_dir: "{{ ansible_user_dir }}/src/review.rdoproject.org/rdo-jobs"
      ansible.builtin.command:
        cmd: >
          ansible-playbook
          -i "{{ ansible_user_dir }}/ci-framework-data/artifacts/zuul_inventory.yml"
          -e "@{{ ansible_user_dir }}/ci-framework-data/artifacts/parameters/zuul-params.yml"
          {{ rdo_jobs_dir }}/playbooks/data_plane_adoption/setup_crc_use_install_yamls_extracted_crc_playbook.yaml
      args:
        chdir: "{{ framework_dir }}"
