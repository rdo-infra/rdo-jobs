- hosts: controller
  vars:
    framework_dir: "/home/zuul/src/github.com/openstack-k8s-operators/ci-framework"
    cifmw_parameters_file: "/home/zuul/vars.yaml"
    rdo_dir: "/home/zuul/src/review.rdoproject.org/rdo-jobs/playbooks/data_plane_adoption"
    cifmw_installyamls_repos: "/home/zuul/src/github.com/openstack-k8s-operators/install_yamls"
    cifwm_data_folder: "/home/zuul/ci-framework-data/artifacts/parameters"
    bootstrap_common_vars: "{{ rdo_dir }}/common_bootstrap_params.yml"
  tasks:
    - name: Install community.general collection
      ansible.builtin.command: ansible-galaxy collection install community.general
      changed_when: false

    - name: Run deploy-edpm.yml playbook
      vars:
        framework_dir: "{{ ansible_user_dir }}/src/github.com/openstack-k8s-operators/ci-framework"
        rdo_jobs_dir: "{{ ansible_user_dir }}/src/review.rdoproject.org/rdo-jobs"
      ansible.builtin.command:
        cmd: >
          ansible-playbook
          -i "{{ ansible_user_dir }}/ci-framework-data/artifacts/zuul_inventory.yml"
          -e "@{{ ansible_user_dir }}/ci-framework-data/artifacts/parameters/zuul-params.yml"
          deploy-edpm.yml
      args:
        chdir: "{{ framework_dir }}"
      changed_when: false

    - name: Run post tasks for setup_crc_use_install_yamls_extracted_crc
      vars:
        framework_dir: "{{ ansible_user_dir }}/src/github.com/openstack-k8s-operators/ci-framework"
        rdo_jobs_dir: "{{ ansible_user_dir }}/src/review.rdoproject.org/rdo-jobs"
      ansible.builtin.command:
        cmd: >
          ansible-playbook
          -i "{{ ansible_user_dir }}/ci-framework-data/artifacts/zuul_inventory.yml"
          -e "@{{ ansible_user_dir }}/ci-framework-data/artifacts/parameters/zuul-params.yml"
          {{ rdo_jobs_dir }}/playbooks/data_plane_adoption/setup_crc_use_install_yamls_extracted_crc_playbook.yaml
      args:
        chdir: "{{ framework_dir }}"
      changed_when: false
