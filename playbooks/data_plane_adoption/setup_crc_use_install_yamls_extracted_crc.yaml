---
# NOTE: It is more a workaround until the playbook would not be migrated
# to ci-framework project dir.
# NOTE: It is very similar to playbook:
# https://github.com/openstack-k8s-operators/ci-framework/blob/main/deploy-edpm.yml
- name: Run nested Ansible
  hosts: controller
  vars:
    framework_dir: "/home/zuul/src/github.com/openstack-k8s-operators/ci-framework"
    cifmw_parameters_file: "/home/zuul/vars.yaml"
    rdo_dir: "/home/zuul/src/review.rdoproject.org/rdo-jobs/playbooks/data_plane_adoption"
    cifmw_installyamls_repos: "/home/zuul/src/github.com/openstack-k8s-operators/install_yamls"
    cifwm_data_folder: "/home/zuul/ci-framework-data/artifacts/parameters"
    bootstrap_common_vars: "{{ rdo_dir }}/common_bootstrap_params.yml"
  tasks:
    - name: Install community.general collection
      ansible.builtin.command: ansible-galaxy collection install community.general

    - name: Run setup_crc_use_install_yamls_extracted_crc playbook
      ansible.builtin.command:
        chdir: "{{ ansible_user_dir }}/src/review.rdoproject.org/rdo-jobs
        cmd: >
          ansible-playbook playbooks/data_plane_adoption/setup_crc_use_install_yamls_extracted_crc_playbook.yaml
