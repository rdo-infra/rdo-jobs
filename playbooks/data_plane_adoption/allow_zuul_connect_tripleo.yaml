- hosts: undercloud
  tasks:
    - name: Add hosts to access all tripleo nodes via controlplane
      vars:
        undercloud_ip: "{{ hostvars['undercloud']['ansible_host'] }}"
      ansible.builtin.add_host:
        name: "{{ item }}-through-undercloud"
        ansible_host: "192.168.122.{{ hostvars[item]['address_suffix'] }}"
        ansible_ssh_common_args: '-o StrictHostKeyChecking=no -J zuul@{{ undercloud_ip }}'
        ansible_user: zuul
        groups: tripleo_nodes
      loop: "{{ groups.all | select('match', '^overcloud*')  }}"
