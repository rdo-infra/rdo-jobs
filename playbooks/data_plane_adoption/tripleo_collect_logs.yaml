- hosts: undercloud,overcloud
  gather_facts: false
  tasks:
    - name: Ensure we have a logs/tripleo directory for the host
      delegate_to: localhost
      ansible.builtin.file:
        path: "/home/zuul/logs/tripleo/{{ inventory_hostname }}"
        state: directory

    - name: Copy log files from user home dir
      failed_when: false
      ansible.posix.synchronize:
        src: '/home/zuul/'
        dest: "home/zuul/logs/tripleo/{{ inventory_hostname }}"
        mode: pull

    - name: create logs/tripleo/containers folder for host
      delegate_to: localhost
      ansible.builtin.file:
        path: "/home/zuul/logs/tripleo/{{ inventory_hostname }}/containers"
        state: directory

    - name: Copy container log files
      become: true
      ansible.posix.synchronize:
        src: '/var/log/containers/'
        dest: '/home/zuul/logs/tripleo/{{ inventory_hostname }}/containers/'
        mode: pull
    - name: run collect_logs
      ansible.builtin.include_role:
        name: collect_logs
      vars:
        undercloud_user: zuul
        artcl_collect_dir: /home/zuul/logs/
        artcl_collect_list:
          - /var/lib/container-puppet/
          - /etc/ansible/
          - /etc/host.conf
          - /etc/hostname
          - /etc/hosts
          - /etc/yum/
          - /etc/dnf/
          - /etc/yum.conf
          - /etc/yum.repos.d/
          - /var/log/journal.txt
          - /var/log/yum.log
          - /var/log/dnf.log
          - /var/log/cloud-init*.log
        artcl_exclude_list:
          - /etc/puppet/modules/
          - /var/log/journal/*
          - /var/log/extra/lsof*
          - /home/{{ undercloud_user }}/tempest/etc/cirros*
          - /home/{{ undercloud_user }}/tempest/.stackviz
          - /home/{{ undercloud_user }}/tempest/.stestr
          - /home/{{ undercloud_user }}/tempest/etc/*.sample
          - /home/{{ undercloud_user }}/.tobiko/cache/
          - /home/{{ undercloud_user }}/.tobiko/*.subunit
          - /home/{{ undercloud_user }}/instackenv.json
          - /etc/pki/rhui/
          - overlay*
          - root
          - console*primary.log
          - anaconda*
          - standalone-install-*
          - undercloud-install-*
          - home/{{ undercloud_user }}/src
          - /lib/rpm/
          - /lib64/pcsd
          - /opt/git
          - /tmp
          - /usr/lib/rpm
          - /usr/lib64/pcsd
          - /var/lib/texmf/
          - /usr/tmp
          - /usr/share/texlive
          - /var/tmp
