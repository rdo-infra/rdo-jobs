- name: Get subnodes
  ansible.builtin.command: cat /etc/nodepool/sub_nodes_private
  register: nodes
  changed_when: false

- name: Get Controller IP
  ansible.builtin.command: cat /etc/nodepool/node_private
  register: controller_ip
  changed_when: false

- name: Get second node ip
  ansible.builtin.set_fact:
    node_ip: "{{ nodes.stdout }}"
    cacheable: true

- name: Get Controller IP
  ansible.builtin.command: cat /etc/nodepool/node_private
  register: controller_ip
  changed_when: false

- name: set the ip_addr of the controller
  ansible.builtin.set_fact:
    ip_addr: ["{{ controller_ip.stdout }}/32"]
    cacheable: true

- name: Generate edpm play
  ansible.builtin.template:
    src: "edpm-play.yaml.j2"
    dest: "{{ deployment_artifacts }}/edpm-play.yaml"

- name: Run EDPM play
  ansible.builtin.shell: |
    source ~/.bashrc
    oc apply -f "{{ deployment_artifacts }}/edpm-play.yaml"
  args:
    executable: /bin/bash
  changed_when: false
