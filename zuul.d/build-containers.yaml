---
# zuul.d/build-containers.yaml
# Zuul layout for TripleO Build Containers jobs.

# Job Inheritance Structure from Upstream
# * tripleo-ci-base-singlenode-standard
# * tripleo-ci-build-containers-required-projects-rdo (required
#   projects from rdo and upstream, playbooks)

# Note: It contains the content from upstream
# tripleo-build-containers-base-noreposetup-required-projects-centos-8
# , tripleo-build-containers-base-noreposetup-centos-8
# tripleo-build-containers-base and ubi 8

- job:
    name: tripleo-ci-build-containers-required-projects-rdo
    abstract: true
    description: |
        Base abstract container build job for singlenode in RDO CI zuulv3 jobs
    parent: tripleo-ci-base-singlenode-standard
    required-projects:
      # Upstream required projects
      - opendev.org/openstack/ansible-role-container-registry
      - opendev.org/openstack/kolla
      - opendev.org/openstack/python-tripleoclient
      - opendev.org/openstack/requirements
      - opendev.org/openstack/tripleo-ansible
      - opendev.org/openstack/tripleo-common
      - opendev.org/openstack/tripleo-repos
      # RDO required projects
      - rdo-infra/ci-config
    roles:
      - zuul: opendev.org/openstack/ansible-role-container-registry
      - zuul: opendev.org/openstack/tripleo-ansible
      - zuul: rdo-infra/ci-config
    pre-run:
      # Playbook from tripleo-ci
      - playbooks/tripleo-buildcontainers/pre.yaml
      # Playbook from rdo config repo
      - playbooks/tripleo-rdo-base/pre.yaml
    run: playbooks/tripleo-buildcontainers/run.yaml
    post-run:
      # Playbook from tripleo-ci
      - playbooks/tripleo-buildcontainers/post.yaml
      # Playbook from rdo config repo
      - playbooks/tripleo-ci-periodic-base/post.yaml
    timeout: 7200
    voting: false
