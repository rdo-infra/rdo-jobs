---
# zuul.d/build-containers.yaml
# Zuul layout for TripleO Build Containers jobs.

# Job Inheritance Structure from Upstream
# * tripleo-ci-base-singlenode-standard
# * tripleo-ci-base-containers-standard
# * tripleo-ci-containers-rdo-upstream-pre
# * tripleo-ci-build-containers-required-projects-rdo (required
#   projects from rdo and upstream, playbooks)

# Note: It contains the content from upstream
# tripleo-build-containers-base-noreposetup-required-projects-centos-8
# , tripleo-build-containers-base-noreposetup-centos-8
# tripleo-build-containers-base and ubi 8

- job:
    name: tripleo-ci-build-containers-required-projects-rdo
    abstract: true
    description: |
        Base abstract container build job for singlenode in RDO CI zuulv3 jobs
    parent: tripleo-ci-containers-rdo-upstream-pre
    required-projects:
      # Upstream required projects
      - opendev.org/openstack/ansible-role-container-registry
      - opendev.org/openstack/kolla
      - opendev.org/openstack/python-tripleoclient
      - opendev.org/openstack/requirements
      - opendev.org/openstack/tripleo-common
      - opendev.org/openstack/tripleo-repos
      # RDO required projects
      - rdo-infra/ci-config
    roles:
      - zuul: opendev.org/openstack/ansible-role-container-registry
      - zuul: opendev.org/openstack/tripleo-ci
      - zuul: rdo-infra/ci-config
    vars:
      release: master
      buildcontainers_override_repos: tripleo-ci-testing
      promote_source: tripleo-ci-testing
      push_registry: trunk.registry.rdoproject.org
      featureset: containers-build

# CentOS 9
- job:
    name: periodic-tripleo-ci-build-containers-centos-9-push-master
    parent: periodic-tripleo-ci-build-containers-rdo-centos-9
    vars:
      buildcontainers_override_repos: centos9-master
      registry_namespace: tripleomastercentos9

- job:
    name: periodic-tripleo-build-containers-base-c9-quay-wallaby
    parent: periodic-tripleo-build-containers-quay-centos-9-secrets
    override-checkout: 'stable/wallaby'
    vars:
      release: wallaby
      branch_override: 'stable/wallaby'
      registry_namespace: tripleowallabycentos9
    attempts: 1

- job:
    name: periodic-tripleo-build-containers-base-c8-quay-wallaby
    parent: periodic-tripleo-build-containers-quay-centos-8-secrets
    override-checkout: 'stable/wallaby'
    vars:
      release: wallaby
      branch_override: 'stable/wallaby'
      registry_namespace: tripleowallabycentos8
    attempts: 1