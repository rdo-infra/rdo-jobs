- project:
    name: rdo-jobs
    check:
      jobs:
        - tox-docs: &cfg
            # 1 using fedora to get python3, can remove once we have centos-8
            # 2 disabled container-fedora as it lacks 'sudo', breaking bindep
            nodeset: rdo-fedora-28
            vars:
              # needed to avoid accidental call of /usr/bin/tox
              tox_executable: "{{ ansible_python.executable }} -m tox"
            pre-run:
              - playbooks/pre-tox.yaml
        - tox-linters: *cfg
        - rdo-tox-molecule: &molecule
            files:
              - ^requirements.txt$
              - ^roles/.*
              - ^setup.*$
              - ^test-requirements.txt$
              - ^tox.ini$
              - .*molecule.*
        - periodic-tripleo-ci-centos-7-standalone-master:
            files:
              - zuul.d/standalone-jobs.yaml
        - registry-login-rdo-integration-centos-7:
            files:
              - playbooks/integration/registry-login.yaml
              - zuul.d/integration.yaml
        - registry-login-rdo-integration-redhat-8:
            files:
              - playbooks/integration/registry-login.yaml
              - zuul.d/integration.yaml
        - tripleo-ceph-integration-master: &ceph
            files:
              - ./playbooks/tripleo-ceph-integration/.*
              - zuul.d/ceph-ansible.yaml
              - ./playbooks/run-rpm-build.yaml
        # TODO(arxcruz): Uncoment once rhel-8 jobs get fixed
        #  - tripleo-ceph-integration-rhel-8-scenario001-standalone:
        #      <<: *ceph
        #      dependencies:
        #        - tripleo-ceph-integration-master
        #  - tripleo-ceph-integration-rhel-8-scenario004-standalone:
        #      <<: *ceph
        #      # this refers to rdo-jobs@master
        #      branches: master
        #      dependencies:
        #        - tripleo-ceph-integration-masterÂ§
        - podman-package-rhel-8: &podman
            files:
              - zuul.d/podman.yaml
              - playbooks/podman/.*
            # until we fix https://github.com/containers/libpod/issues/4665
            voting: false
        - podman-package-centos-8: *podman
        - podman-package-fedora-30: *podman

    gate:
      jobs:
        - tox-docs: *cfg
        - tox-linters: *cfg
        - rdo-tox-molecule: *molecule
