---
- job:
    # This is an abstract job to share common bits for each ooo-ceph integration jobs
    name: tripleo-ceph-integration
    # abstract means you can't use it directly, it can only be the parent of a job.
    abstract: true
    pre-run: playbooks/tripleo-ceph-integration/pre.yaml
    run: playbooks/tripleo-ceph-integration/run.yaml
    post-run: playbooks/tripleo-ceph-integration/post.yaml
    # files makes the job run only if one of the elem is modified by the PR
    # files:
    #   Until job is working as expected, use a test file trigger
    #   - test-ci
    #   When the job is working, only run it when those files are modified
    #   - roles/.*
    #   - plugins/.*
    #   - library/.*
    #   - group_vars/.*
    nodeset:
      nodes:
        - name: test
          label: rdo-centos-7

- job:
    name: tripleo-ceph-integration-master
    parent: tripleo-ceph-integration
    required-projects:
      # without options, the branch of the PR is used for the required-projects
      - name: opendev.org/openstack/tripleo-heat-templates
      - name: github.com/ceph/ceph-ansible
    vars:
      dist: "el8"
      mock_config: "epel-8-x86_64"

- job:
    name: tripleo-ceph-integration-rocky
    parent: tripleo-ceph-integration
    # this job run only for stable-3.2 PR
    branches: stable-3.2
    required-projects:
      - name: opendev.org/openstack/tripleo-heat-templates
        # using override-checkout, we can map ceph-ansible branch to rdo branch
        override-checkout: stable/rocky
      - name: github.com/ceph/ceph-ansible

- job:
    name: tripleo-ceph-integration-queens
    parent: tripleo-ceph-integration
    # this job run only for stable-3.2 PR
    branches: stable-3.2
    required-projects:
      - name: opendev.org/openstack/tripleo-heat-templates
        # using override-checkout, we can map ceph-ansible branch to rdo branch
        override-checkout: stable/queens
      - name: github.com/ceph/ceph-ansible

- job:
    name: tripleo-ceph-integration-train
    parent: tripleo-ceph-integration
    branches: stable-4.0
    required-projects:
      - name: opendev.org/openstack/tripleo-heat-templates
        override-checkout: stable/train
      - name: github.com/ceph/ceph-ansible
    vars:
      dist: "el8"
      mock_config: "epel-8-x86_64"

# RHEL 8 Jobs

- job:
    name: tripleo-ceph-integration-rhel-8-scenario001-standalone
    parent: tripleo-ci-rhel-8-standalone-rdo
    run: playbooks/run-rpm-build.yaml
    required-projects:
      # without options, the branch of the PR is used for the required-projects
      - name: opendev.org/openstack/tripleo-heat-templates
      - name: github.com/ceph/ceph-ansible
    vars:
      featureset: '052'
      release: master
      standalone_ceph: true
      featureset_override: &scenario001_podman
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario001-standalone.yaml'
        run_tempest: false
        use_os_tempest: false

- job:
    name: tripleo-ceph-integration-rhel-8-scenario004-standalone
    parent: tripleo-ci-rhel-8-standalone-rdo
    run: playbooks/run-rpm-build.yaml
    required-projects:
      # without options, the branch of the PR is used for the required-projects
      - name: opendev.org/openstack/tripleo-heat-templates
      - name: github.com/ceph/ceph-ansible
    vars:
      featureset_override: &scenario004_podman
        run_tempest: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario004-standalone.yaml'
          - 'environments/podman.yaml'
        use_os_tempest: false

- job:
    name: tripleo-ceph-integration-rhel-8-scenario001-standalone-train
    parent: tripleo-ci-rhel-8-standalone-rdo
    run: playbooks/run-rpm-build.yaml
    branches: ^stable-4.0$
    required-projects:
      # without options, the branch of the PR is used for the required-projects
      - name: opendev.org/openstack/tripleo-heat-templates
        override-checkout: stable/train
      - name: github.com/ceph/ceph-ansible
    vars:
      featureset: '052'
      release: train
      standalone_ceph: true
      featureset_override: *scenario001_podman

- job:
    name: tripleo-ceph-integration-rhel-8-scenario004-standalone-train
    parent: tripleo-ci-rhel-8-standalone-rdo
    run: playbooks/run-rpm-build.yaml
    required-projects:
      # without options, the branch of the PR is used for the required-projects
      - name: opendev.org/openstack/tripleo-heat-templates
        override-checkout: stable/train
      - name: github.com/ceph/ceph-ansible
    branches: ^stable-4.0$
    vars:
      featureset: '052'
      release: train
      standalone_ceph: true
      featureset_override: *scenario004_podman

# Periodic jobs

- job:
    name: periodic-tripleo-ceph-integration-master
    parent: tripleo-ceph-integration-master

- job:
    name: periodic-tripleo-ceph-integration-rhel-8-scenario001-standalone
    parent: periodic-tripleo-ci-rhel-8-standalone-rdo
    run: playbooks/run-rpm-build.yaml
    required-projects:
      # without options, the branch of the PR is used for the required-projects
      - name: opendev.org/openstack/tripleo-heat-templates
      - name: github.com/ceph/ceph-ansible
    vars:
      featureset: '052'
      release: master
      standalone_ceph: true
      featureset_override: *scenario001_podman

- job:
    name: periodic-tripleo-ceph-integration-rhel-8-scenario004-standalone
    parent: periodic-tripleo-ci-rhel-8-standalone-rdo
    run: playbooks/run-rpm-build.yaml
    required-projects:
      # without options, the branch of the PR is used for the required-projects
      - name: opendev.org/openstack/tripleo-heat-templates
      - name: github.com/ceph/ceph-ansible
    vars:
      featureset_override: *scenario004_podman
