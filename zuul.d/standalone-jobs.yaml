---
# zuul.d/standalone-jobs.yaml
# Zuul layout for TripleO standalone jobs.
# It contains all the jobs related to standalone installer testing.


#############################
# Standalone Jobs Parenting #
#############################

- job:
    name: tripleo-ci-standalone-required-projects-rdo
    abstract: true
    description: |
      Base abstract job for standalone in RDO CI zuulv3 jobs
    parent: tripleo-ci-base-standalone-standard
    roles:
      - zuul: opendev.org/openstack/ansible-role-container-registry
      - zuul: opendev.org/openstack/tripleo-ansible
      - zuul: rdo-infra/ci-config
    required-projects:
      - opendev.org/openstack/ansible-role-container-registry
      - opendev.org/openstack/tripleo-ansible
      - rdo-infra/ci-config

- job:
    name: tripleo-ci-standalone-upgrade-required-projects-rdo
    abstract: true
    description: |
      Base abstract job for standalone upgrade in RDO CI zuulv3 jobs
    parent: tripleo-ci-base-standalone-upgrade-standard
    roles:
      - zuul: opendev.org/openstack/ansible-role-container-registry
      - zuul: opendev.org/openstack/tripleo-ansible
    required-projects:
      - opendev.org/openstack/ansible-role-container-registry
      - opendev.org/openstack/tripleo-ansible


### CentOS-8 Jobs
- job:
    name: periodic-tripleo-ci-centos-8-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8
    vars:
      featureset: '052'
      release: master

- job:
    name: periodic-tripleo-ci-centos-9-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9
    vars:
      featureset: '052'
      release: master

- job:
    name: periodic-tripleo-ci-centos-8-standalone-full-tempest-api-master
    parent: tripleo-ci-standalone-full-tempest-api-options

- job:
    name: periodic-tripleo-ci-centos-8-standalone-full-tempest-api-master
    parent: periodic-tripleo-ci-centos-8-standalone-master
    timeout: 14400
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-9-standalone-full-tempest-api-master
    parent: tripleo-ci-standalone-full-tempest-api-options

- job:
    name: periodic-tripleo-ci-centos-9-standalone-full-tempest-api-master
    parent: periodic-tripleo-ci-centos-9-standalone-master
    timeout: 14400
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-8-standalone-full-tempest-scenario-master
    parent: tripleo-ci-standalone-full-tempest-scenario-options

- job:
    name: periodic-tripleo-ci-centos-8-standalone-full-tempest-scenario-master
    parent: periodic-tripleo-ci-centos-8-standalone-master
    timeout: 14400
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-9-standalone-full-tempest-scenario-master
    parent: tripleo-ci-standalone-full-tempest-scenario-options

- job:
    name: periodic-tripleo-ci-centos-9-standalone-full-tempest-scenario-master
    parent: periodic-tripleo-ci-centos-9-standalone-master
    timeout: 14400
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-8-scenario001-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8

- job:
    name: periodic-tripleo-ci-centos-8-scenario001-standalone-master
    parent: tripleo-ci-scenario001-standalone-options
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-9-scenario001-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9

- job:
    name: periodic-tripleo-ci-centos-9-scenario001-standalone-master
    parent: tripleo-ci-scenario001-standalone-options
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-8-scenario002-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8

- job:
    name: periodic-tripleo-ci-centos-8-scenario002-standalone-master
    parent: tripleo-ci-scenario002-standalone-options
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-9-scenario002-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9

- job:
    name: periodic-tripleo-ci-centos-9-scenario002-standalone-master
    parent: tripleo-ci-scenario002-standalone-options
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-8-scenario003-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8

- job:
    name: periodic-tripleo-ci-centos-8-scenario003-standalone-master
    parent: tripleo-ci-scenario003-standalone-options
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-9-scenario003-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9

- job:
    name: periodic-tripleo-ci-centos-9-scenario003-standalone-master
    parent: tripleo-ci-scenario003-standalone-options
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-8-scenario004-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8

- job:
    name: periodic-tripleo-ci-centos-8-scenario004-standalone-master
    parent: tripleo-ci-scenario004-standalone-options
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-9-scenario004-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9

- job:
    name: periodic-tripleo-ci-centos-9-scenario004-standalone-master
    parent: tripleo-ci-scenario004-standalone-options
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-8-scenario007-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8
    vars: &vars_standalone_007
      featureset: '052'
      release: master
      featureset_override:
        run_tempest: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario007-standalone.yaml'
        tempest_services:
          - neutron
        tempest_test_whitelist:
          - 'tempest.scenario.test_network_basic_ops.TestNetworkBasicOps.test_network_basic_ops'
          - 'tempest.scenario.test_minimum_basic.TestMinimumBasicScenario.test_minimum_basic_scenario'
        tempest_private_net_provider_type: 'vxlan'
        use_os_tempest: true

- job:
    name: periodic-tripleo-ci-centos-9-scenario007-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9
    vars: *vars_standalone_007

- job:
    name: periodic-tripleo-ci-centos-8-scenario010-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8
    timeout: 14400
    vars: &vars_standalone_010
      tags:
        - build
        - standalone
        - octavia
      # using featureset062 is tech debt and should be addressed at a future sprint
      featureset: '062'
      release: master
      standalone_ceph: true
      featureset_override:
        validate_services: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'

- job:
    name: periodic-tripleo-ci-centos-9-scenario010-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9
    timeout: 14400
    vars: *vars_standalone_010

- job:
    name: periodic-tripleo-ci-centos-8-scenario010-kvm-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8
    nodeset: single-centos-8-node-psi
    vars: &vars_standalone_010_kvm
      tags:
        - build
        - nested_virt
        - standalone
        - octavia
      # using featureset062 is tech debt and should be addressed at a future sprint
      featureset: '062'
      release: master
      standalone_ceph: true
      featureset_override:
        validate_services: false
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'
          - 'ci/environments/octavia-kvm.yaml'

- job:
    name: periodic-tripleo-ci-centos-8-scenario010-ovn-provider-standalone-master
    parent: periodic-tripleo-ci-centos-8-scenario010-standalone-master
    vars: &vars_standalone_010_ovn
      featureset_override:
        validate_services: false
        tempest_tempestconf_profile_overrides:
          load_balancer.provider: 'ovn'
          load_balancer.member_role: '"Member"'
          load_balancer.test_reuse_connection: false
          load_balancer.load_balancing_algorithm: 'SOURCE_IP_PORT'
          load_balancer.test_flavors: false
          loadbalancer-feature-enabled.health_monitor_enabled: false
          loadbalancer-feature-enabled.pool_algorithms_enabled: false
          loadbalancer-feature-enabled.l7_protocol_enabled: false
          loadbalancer-feature-enabled.l4_protocol: 'TCP'
          loadbalancer-feature-enabled.session_persistence_enabled: false
          loadbalancer-feature-enabled.not_implemented_is_error: false
          network-feature-enabled.port_security: true
          load_balancer.test_server_path: >-
            "/usr/lib/python{{ [ansible_python.version.major, ansible_python.version.minor] | join('.') }}/site-packages/octavia_tempest_plugin/contrib/test_server/test_server.bin"
        tempest_test_whitelist:
          # The parent class runs *smoke, which only runs HTTP tests that
          # the ovn-provider doesn't support, so run some it does.
          - '^octavia_tempest_plugin.tests.scenario.v2.test_load_balancer.LoadBalancerScenarioTest'
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario010-standalone.yaml'

- job:
    name: periodic-tripleo-ci-centos-9-scenario010-kvm-standalone-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9
    nodeset: single-centos-9-node-nested-virt
    timeout: 14400
    vars: *vars_standalone_010_kvm

- job:
    name: periodic-tripleo-ci-centos-9-scenario010-ovn-provider-standalone-master
    parent: periodic-tripleo-ci-centos-9-scenario010-standalone-master
    vars: *vars_standalone_010_ovn

- job:
    name: periodic-tripleo-ci-centos-8-scenario012-standalone-master
    parent: tripleo-ci-scenario012-standalone-options

- job:
    name: periodic-tripleo-ci-centos-8-scenario012-standalone-master
    voting: false
    parent: periodic-tripleo-ci-standalone-rdo-centos-8
    vars:
      release: master

- job:
    name: periodic-tripleo-ci-centos-9-scenario012-standalone-master
    parent: tripleo-ci-scenario012-standalone-options

- job:
    name: periodic-tripleo-ci-centos-9-scenario012-standalone-master
    voting: false
    parent: periodic-tripleo-ci-standalone-rdo-centos-9

- job:
    name: periodic-tripleo-ci-centos-8-standalone-upgrade-master
    parent: tripleo-ci-base-standalone-upgrade-periodic-centos-8
    voting: false
    vars:
      featureset: '056'
      release: master
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'environments/docker-ha.yaml'
          - 'environments/podman.yaml'

- job:
    name: periodic-tripleo-ci-centos-8-standalone-on-multinode-ipa-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-8
    nodeset: two-centos-8-nodes-vexxhost
    required-projects: &standalone_ipa_rp
      - opendev.org/x/tripleo-ipa
      - opendev.org/openstack/tripleo-ansible
    roles: &standalone_ipa_roles
      - zuul: opendev.org/x/tripleo-ipa
      - zuul: opendev.org/openstack/tripleo-ansible
    vars: &vars_standalone_ipa
      featureset: '052'
      release: master
      enable_tls: true
      playbooks:
        - quickstart.yml
        - multinode-standalone-ipa.yml
        - multinode-standalone.yml
      featureset_override:
        standalone_environment_files:
          - environments/ssl/tls-everywhere-endpoints-dns.yaml
          - environments/services/haproxy-public-tls-certmonger.yaml
          - environments/ssl/enable-internal-tls.yaml
          - ci/environments/standalone-ipa.yaml
        tempest_tempest_conf_overrides:
          service-clients.http_timeout: '120'

- job:
    name: periodic-tripleo-ci-centos-9-standalone-on-multinode-ipa-master
    parent: periodic-tripleo-ci-standalone-rdo-centos-9
    nodeset: two-centos-9-nodes-vexxhost
    required-projects: *standalone_ipa_rp
    roles: *standalone_ipa_roles
    vars: *vars_standalone_ipa

### stable/train standalone jobs ###

########## C E N T O S 8 TRAIN #############################
- job:
    name: periodic-tripleo-ci-centos-8-standalone-train
    parent: periodic-tripleo-ci-centos-8-standalone-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-standalone-full-tempest-api-train
    parent: periodic-tripleo-ci-centos-8-standalone-full-tempest-api-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-standalone-full-tempest-scenario-train
    parent: periodic-tripleo-ci-centos-8-standalone-full-tempest-scenario-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-scenario001-standalone-train
    parent: periodic-tripleo-ci-centos-8-scenario001-standalone-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-scenario002-standalone-train
    parent: periodic-tripleo-ci-centos-8-scenario002-standalone-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-scenario003-standalone-train
    parent: periodic-tripleo-ci-centos-8-scenario003-standalone-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-scenario004-standalone-train
    parent: periodic-tripleo-ci-centos-8-scenario004-standalone-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-scenario007-standalone-train
    parent: periodic-tripleo-ci-centos-8-scenario007-standalone-master
    override-checkout: "stable/train"
    voting: false
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-scenario010-standalone-train
    parent: periodic-tripleo-ci-centos-8-scenario010-standalone-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-scenario010-kvm-standalone-train
    parent: periodic-tripleo-ci-centos-8-scenario010-kvm-standalone-master
    override-checkout: 'stable/train'
    vars:
      branch_override: 'stable/train'
      release: train

- job:
    name: periodic-tripleo-ci-centos-8-scenario012-standalone-train
    parent: periodic-tripleo-ci-centos-8-scenario012-standalone-master
    override-checkout: "stable/train"
    vars:
      branch_override: "stable/train"
      release: train
