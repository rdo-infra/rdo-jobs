---
- job:
    # This is an abstract job to share common bits for each podman jobs
    name: podman-package
    abstract: true
    pre-run: playbooks/podman/pre.yaml
    run: playbooks/podman/run.yaml
    post-run: playbooks/podman/post.yaml
    nodeset: centos-8

- job:
    name: podman-package-centos-8
    parent: podman-package
    # branches makes this job run only for master PR
    branches: master
    required-projects:
      # without options, the branch of the PR is used for the required-projects
      - name: opendev.org/openstack/tripleo-heat-templates
      - name: github.com/containers/libpod

- job:
    name: podman-package-centos-7
    parent: podman-package-centos-8
    nodeset: centos-7

- job:
    name: podman-package-rhel-8
    parent: podman-package-centos-8
    nodeset: upstream-rhel-8

- job:
    name: podman-package-fedora-30
    parent: podman-package-centos-8
    nodeset: single-fedora-30-node

# Podman TripleO integration Jobs

## Keystone based standalone deployment

- job:
    name: tripleo-podman-integration-rhel-8-scenario000-standalone
    parent: tripleo-ci-base-standalone-periodic
    nodeset: single-rhel-8-node
    branches: ^master$
    run: playbooks/podman/install-podman-rpm.yaml
    required-projects:
      - name: github.com/containers/libpod
    vars:
      featureset: '052'
      release: master
      registry_login_enabled: false
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario000-standalone.yaml'
          - 'environments/podman.yaml'
        run_tempest: false
        use_os_tempest: false

## Plain standalone deployment

- job:
    name: tripleo-podman-integration-rhel-8-standalone
    parent: tripleo-ci-base-standalone-periodic
    nodeset: single-rhel-8-node
    branches: ^master$
    run: playbooks/podman/install-podman-rpm.yaml
    required-projects:
      - name: github.com/containers/libpod
    vars:
      featureset: '052'
      release: master
      registry_login_enabled: false
      featureset_override:
        run_tempest: false
        use_os_tempest: true

- job:
    name: tripleo-podman-integration-centos-8-scenario000-standalone
    parent: tripleo-ci-base-standalone-periodic-centos-8
    branches: ^master$
    run: playbooks/podman/install-podman-rpm.yaml
    required-projects:
      - name: github.com/containers/libpod
    vars:
      featureset: '052'
      release: master
      registry_login_enabled: false
      featureset_override:
        standalone_environment_files:
          - 'environments/low-memory-usage.yaml'
          - 'ci/environments/scenario000-standalone.yaml'
          - 'environments/podman.yaml'
        run_tempest: false
        use_os_tempest: false

## Plain standalone deployment

- job:
    name: tripleo-podman-integration-centos-8-standalone
    parent: tripleo-ci-base-standalone-periodic-centos-8
    branches: ^master$
    run: playbooks/podman/install-podman-rpm.yaml
    required-projects:
      - name: github.com/containers/libpod
    vars:
      featureset: '052'
      release: master
      registry_login_enabled: false
      featureset_override:
        run_tempest: false
        use_os_tempest: true
