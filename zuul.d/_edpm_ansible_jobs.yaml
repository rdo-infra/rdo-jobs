- job:
    name: edpm-ansible-github-rdo-integration-centos-8-crc-singlenode-centos-9-external-compute
    parent: base-crc
    nodeset: centos-8-crc-single-node-centos-9-external-compute
    timeout: 10800
    required-projects: &edpm_required_projects
      - openstack-k8s-operators/install_yamls
      - opendev.org/zuul/zuul-jobs
      - opendev.org/openstack/tripleo-repos
      - openstack-k8s-operators/openstack-operator
      - name: openstack-k8s-operators/edpm-ansible
        override-checkout: main
      - name: openstack-k8s-operators/openstack-ansibleee-operator
        override-checkout: main
      - rdo-jobs
    roles:
      - zuul: rdo-jobs
    pre-run: playbooks/edpm/subnode_ip.yaml
    run: playbooks/edpm/deploy_podified_control_plane.yaml
    post-run: playbooks/edpm/collect_logs.yaml
    vars: &edpm_vars
      registry_login_enabled: true
      push_registry: quay.rdoproject.org
      quay_login_secret_name: quay_nextgen_zuulgithubci
      crc_parameters: "--memory 22000 --disk-size 120 --cpus 6"
      pre_pull_images:
        - registry.redhat.io/rhosp-rhel9/openstack-rabbitmq:17.0

- job:
    name: openstack-ansibleee-operator-github-rdo-integration-centos-8-crc-singlenode-centos-9-external-compute
    parent: base-crc
    nodeset: centos-8-crc-single-node-centos-9-external-compute
    timeout: 10800
    required-projects: *edpm_required_projects
    roles:
      - zuul: rdo-jobs
    pre-run: playbooks/edpm/subnode_ip.yaml
    run: playbooks/edpm/deploy_podified_control_plane.yaml
    post-run: playbooks/edpm/collect_logs.yaml
    vars:
      <<: *edpm_vars
      build_operators: true

# Periodic Jobs
- job:
    name: periodic-centos-9-podified-edpm-integration-master
    parent: base-crc
    nodeset: centos-8-crc-single-node-centos-9-external-compute
    timeout: 10800
    required-projects: *edpm_required_projects
    roles:
      - zuul: rdo-jobs
    pre-run: playbooks/edpm/subnode_ip.yaml
    run: playbooks/edpm/deploy_podified_control_plane.yaml
    post-run: playbooks/edpm/collect_logs.yaml
    vars:
      <<: *edpm_vars
      registry_namespace: podified-main-centos9
      openstack_release: master
      promote_source: podified-ci-testing


- job:
    name: periodic-centos-9-podified-edpm-integration-zed
    parent: periodic-centos-9-podified-edpm-integration-master
    vars:
      registry_namespace: podified-zed-centos9
      openstack_release: zed
